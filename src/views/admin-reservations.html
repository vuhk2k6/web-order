<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ƒê·∫∑t b√†n - CAFRROTSFUD Admin</title>
  <link rel="stylesheet" href="/@style/admin.css" />
</head>
<body class="admin-page">
  <div class="admin-shell">
    <aside class="admin-sidebar" aria-label="Thanh ƒëi·ªÅu h∆∞·ªõng ch√≠nh">
      <a href="/admin" class="admin-logo-link" aria-label="V·ªÅ trang T·ªïng quan">
        <div class="admin-logo">
          <div class="admin-logo-mark" tabindex="0" aria-label="Logo nh√† h√†ng">
            <img src="/img/logoadmin.png" alt="Logo CAFRROTSFUD" class="admin-logo-img" />
          </div>
        </div>
      </a>
      <div class="sidebar-section">
        <nav class="sidebar-nav">
          <a href="/admin" class="nav-link" aria-label="ƒêi t·ªõi t·ªïng quan">T·ªïng quan</a>
          <a href="/admin/orders" class="nav-link" aria-label="ƒêi t·ªõi ƒë∆°n h√†ng">
            ƒê∆°n h√†ng
            <span id="nav-orders-badge" class="nav-badge">0</span>
          </a>
          <a href="/admin/reservations" class="nav-link active" aria-label="ƒêi t·ªõi ƒë·∫∑t b√†n">
            ƒê·∫∑t b√†n
            <span id="nav-reservations-badge" class="nav-badge">0</span>
          </a>
          <a href="/admin/menu" class="nav-link" aria-label="ƒêi t·ªõi th·ª±c ƒë∆°n">Th·ª±c ƒë∆°n</a>
          <a href="/admin/customers" class="nav-link" aria-label="ƒêi t·ªõi kh√°ch h√†ng">Kh√°ch h√†ng</a>
          <a href="/admin/promotions" class="nav-link" aria-label="ƒêi t·ªõi khuy·∫øn m√£i">Khuy·∫øn m√£i</a>
        </nav>
      </div>
      <div class="sidebar-footer">
        <p class="sidebar-help">C·∫ßn h·ªó tr·ª£? Li√™n h·ªá qu·∫£n tr·ªã vi√™n.</p>
      </div>
    </aside>

    <div class="admin-main">
      <header class="admin-topbar">
        <div class="topbar-left">
          <h1 class="topbar-title">ƒê·∫∑t b√†n</h1>
          <p class="topbar-subtitle">Theo d√µi v√† x√°c nh·∫≠n y√™u c·∫ßu ƒë·∫∑t b√†n</p>
        </div>
        <div class="topbar-actions">
          <button type="button" class="btn-secondary">Xu·∫•t danh s√°ch</button>
          <button type="button" class="btn-logout">ƒêƒÉng xu·∫•t</button>
          <div class="user-avatar" aria-label="T√†i kho·∫£n qu·∫£n tr·ªã" tabindex="0">
            <img src="/img/logoadmin.png" alt="·∫¢nh ƒë·∫°i di·ªán" />
          </div>
        </div>
      </header>

      <main id="reservations-main" class="admin-content">
        <!-- Table Map Section -->
        <section class="panel">
          <div class="panel-block-header">
            <div>
              <h2 class="panel-title">S∆° ƒë·ªì b√†n</h2>
              <p class="panel-text">C·∫≠p nh·∫≠t tr·∫°ng th√°i b√†n tr·ª±c ti·∫øp t·∫°i qu√°n.</p>
            </div>
            <button type="button" class="btn-secondary" aria-label="L√†m m·ªõi s∆° ƒë·ªì b√†n" onclick="fetchAdminTables()">L√†m m·ªõi</button>
          </div>
          
          <div class="admin-table-legend">
            <div class="admin-legend-item">
              <div class="admin-legend-color admin-legend-available"></div>
              <span>B√†n tr·ªëng</span>
            </div>
            <div class="admin-legend-item">
              <div class="admin-legend-color admin-legend-reserved"></div>
              <span>ƒê√£ ƒë·∫∑t (ch∆∞a x√°c nh·∫≠n/ch∆∞a ƒë·∫øn gi·ªù)</span>
            </div>
            <div class="admin-legend-item">
              <div class="admin-legend-color admin-legend-occupied"></div>
              <span>ƒêang d√πng</span>
            </div>
          </div>
          
          <div id="admin-table-map-container" class="admin-table-map-container">
            <!-- Tables will be rendered here -->
          </div>
        </section>

        <!-- Active Reservations List Section -->
        <section class="panel">
          <div class="panel-block-header">
            <div>
              <h2 class="panel-title">ƒê∆°n ch∆∞a ho√†n th√†nh</h2>
              <p class="panel-text">X√°c nh·∫≠n, g√°n b√†n v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i cho c√°c ƒë∆°n ƒëang ch·ªù x·ª≠ l√Ω.</p>
            </div>
            <button type="button" class="btn-secondary" aria-label="L√†m m·ªõi danh s√°ch" onclick="fetchAdminReservations()">L√†m m·ªõi</button>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>M√£ ƒë·∫∑t b√†n</th>
                  <th>Kh√°ch h√†ng</th>
                  <th>S·ªë ƒëi·ªán tho·∫°i</th>
                  <th>S·ªë kh√°ch</th>
                  <th>Ng√†y gi·ªù</th>
                  <th>B√†n</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th>Thao t√°c</th>
                </tr>
              </thead>
              <tbody id="admin-reservations-active-body"></tbody>
            </table>
            <p id="admin-reservations-active-empty" class="table-empty" style="display: none;">
              Kh√¥ng c√≥ ƒë∆°n n√†o ƒëang ch·ªù x·ª≠ l√Ω.
            </p>
          </div>
        </section>

        <!-- Completed/Cancelled Reservations List Section -->
        <section class="panel">
          <div class="panel-block-header">
            <div>
              <h2 class="panel-title">ƒê∆°n ƒë√£ ho√†n th√†nh / H·ªßy</h2>
              <p class="panel-text">L·ªãch s·ª≠ c√°c ƒë∆°n ƒë·∫∑t b√†n ƒë√£ ho√†n th√†nh ho·∫∑c ƒë√£ h·ªßy.</p>
            </div>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>M√£ ƒë·∫∑t b√†n</th>
                  <th>Kh√°ch h√†ng</th>
                  <th>S·ªë ƒëi·ªán tho·∫°i</th>
                  <th>S·ªë kh√°ch</th>
                  <th>Ng√†y gi·ªù</th>
                  <th>B√†n</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th>L√Ω do h·ªßy</th>
                </tr>
              </thead>
              <tbody id="admin-reservations-completed-body"></tbody>
            </table>
            <p id="admin-reservations-completed-empty" class="table-empty" style="display: none;">
              Ch∆∞a c√≥ ƒë∆°n n√†o ƒë√£ ho√†n th√†nh ho·∫∑c h·ªßy.
            </p>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Cancel Reservation Modal -->
  <div id="cancel-reservation-modal-overlay" class="modal-overlay" aria-hidden="true" style="display: none;">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="cancel-reservation-modal-title">
      <div class="modal-header">
        <h2 id="cancel-reservation-modal-title" class="panel-title">H·ªßy ƒë·∫∑t b√†n</h2>
        <button type="button" id="cancel-reservation-modal-close" class="btn-text">ƒê√≥ng</button>
      </div>
      <p class="panel-text">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë·∫∑t b√†n n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.</p>
      <form id="cancel-reservation-form" class="admin-form" aria-label="Form h·ªßy ƒë·∫∑t b√†n">
        <input id="cancel-reservation-id" type="hidden" />
        <div>
          <label for="cancel-reservation-reason" class="form-label">L√Ω do h·ªßy (t√πy ch·ªçn)</label>
          <textarea 
            id="cancel-reservation-reason" 
            name="cancelReason" 
            rows="4" 
            class="form-input" 
            placeholder="Nh·∫≠p l√Ω do h·ªßy ƒë·∫∑t b√†n (n·∫øu c√≥)..."
          ></textarea>
        </div>
        <div class="admin-form-footer">
          <button id="cancel-reservation-cancel-btn" type="button" class="btn-text">Kh√¥ng h·ªßy</button>
          <button id="cancel-reservation-submit-btn" type="submit" class="btn-save" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
            X√°c nh·∫≠n h·ªßy
          </button>
        </div>
        <p id="cancel-reservation-message" class="admin-message" aria-live="polite" style="display: none;"></p>
      </form>
    </div>
  </div>

  <!-- Complete Reservation Modal -->
  <div id="complete-reservation-modal-overlay" class="modal-overlay" aria-hidden="true" style="display: none;">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="complete-reservation-modal-title">
      <div class="modal-header">
        <h2 id="complete-reservation-modal-title" class="panel-title">Ho√†n th√†nh ƒë·∫∑t b√†n</h2>
        <button type="button" id="complete-reservation-modal-close" class="btn-text">ƒê√≥ng</button>
      </div>
      <p class="panel-text">X√°c nh·∫≠n ho√†n th√†nh ƒë·∫∑t b√†n n√†y? B√†n s·∫Ω ƒë∆∞·ª£c ƒë√°nh d·∫•u l√† tr·ªëng v√† s·∫µn s√†ng cho kh√°ch ti·∫øp theo.</p>
      <form id="complete-reservation-form" class="admin-form" aria-label="Form ho√†n th√†nh ƒë·∫∑t b√†n">
        <input id="complete-reservation-id" type="hidden" />
        <div class="admin-form-footer">
          <button id="complete-reservation-cancel-btn" type="button" class="btn-text">H·ªßy</button>
          <button id="complete-reservation-submit-btn" type="submit" class="btn-save">
            X√°c nh·∫≠n ho√†n th√†nh
          </button>
        </div>
        <p id="complete-reservation-message" class="admin-message" aria-live="polite" style="display: none;"></p>
      </form>
    </div>
  </div>

  <!-- Update Table Status Modal -->
  <div id="update-table-status-modal-overlay" class="modal-overlay" aria-hidden="true" style="display: none;">
    <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="update-table-status-modal-title">
      <div class="modal-header">
        <h2 id="update-table-status-modal-title" class="panel-title">C·∫≠p nh·∫≠t tr·∫°ng th√°i b√†n</h2>
        <button type="button" id="update-table-status-modal-close" class="btn-text">ƒê√≥ng</button>
      </div>
      <p class="panel-text">Ch·ªçn tr·∫°ng th√°i m·ªõi cho b√†n <strong id="update-table-status-name"></strong></p>
      <form id="update-table-status-form" class="admin-form" aria-label="Form c·∫≠p nh·∫≠t tr·∫°ng th√°i b√†n">
        <input id="update-table-status-id" type="hidden" />
        <div>
          <label class="form-label">Tr·∫°ng th√°i</label>
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease;" class="table-status-option">
              <input type="radio" name="table-status" value="TRONG" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;" />
              <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                <span style="font-size: 24px;">üü¢</span>
                <div>
                  <div style="font-weight: 600; color: #020617; margin-bottom: 2px;">B√†n tr·ªëng</div>
                  <div style="font-size: 13px; color: #64748b;">B√†n s·∫µn s√†ng nh·∫≠n kh√°ch</div>
                </div>
              </div>
            </label>
            <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease;" class="table-status-option">
              <input type="radio" name="table-status" value="RESERVED" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;" />
              <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                <span style="font-size: 24px;">üîµ</span>
                <div>
                  <div style="font-weight: 600; color: #020617; margin-bottom: 2px;">C√≥ h·∫πn ch∆∞a ƒë·∫øn gi·ªù</div>
                  <div style="font-size: 13px; color: #64748b;">B√†n ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t nh∆∞ng ch∆∞a ƒë·∫øn gi·ªù</div>
                </div>
              </div>
            </label>
            <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.2s ease;" class="table-status-option">
              <input type="radio" name="table-status" value="DANG_DUNG" style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;" />
              <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                <span style="font-size: 24px;">üü°</span>
                <div>
                  <div style="font-weight: 600; color: #020617; margin-bottom: 2px;">ƒêang c√≥ kh√°ch</div>
                  <div style="font-size: 13px; color: #64748b;">Kh√°ch ƒëang s·ª≠ d·ª•ng b√†n</div>
                </div>
              </div>
            </label>
          </div>
        </div>
        <div class="admin-form-footer">
          <button id="update-table-status-cancel-btn" type="button" class="btn-text">H·ªßy</button>
          <button id="update-table-status-submit-btn" type="submit" class="btn-save">
            C·∫≠p nh·∫≠t tr·∫°ng th√°i
          </button>
        </div>
        <p id="update-table-status-message" class="admin-message" aria-live="polite" style="display: none;"></p>
      </form>
    </div>
  </div>

  <script src="/js/admin.js" defer></script>
</body>
</html>

